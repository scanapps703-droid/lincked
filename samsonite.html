<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MODULE SCAN - Samsonite</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --spark-primary: #3490dc;
            --spark-primary-dark: #2779bd;
            --spark-secondary: #6c757d;
            --spark-success: #38c172;
            --spark-success-dark: #2d995b;
            --spark-danger: #e3342f;
            --spark-danger-dark: #cc1f1a;
            --spark-warning: #ffed4a;
            --spark-warning-dark: #f2d024;
            --spark-info: #6cb2eb;
            --spark-light: #f8f9fa;
            --spark-dark: #343a40;
            --spark-gray: #6c757d;
            --spark-gray-light: #e2e8f0;
            --spark-border: #e2e8f0;
            --spark-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --spark-radius: 0.375rem;
            --spark-transition: all 0.2s ease;
            --spark-sidebar-width: 16rem;
            --spark-header-height: 4rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f7fa;
            color: #4a5568;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            border-left: 4px solid var(--spark-primary);
        }

        h1 {
            color: var(--spark-primary);
            margin: 0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 2.5rem;
            border-radius: var(--spark-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            border-top: 4px solid var(--spark-primary);
        }

        .login-box h2 {
            color: var(--spark-primary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .login-box p {
            color: var(--spark-gray);
            margin-bottom: 1.5rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-input {
            padding: 0.75rem 1rem;
            border: 1px solid var(--spark-border);
            border-radius: var(--spark-radius);
            font-size: 1rem;
            transition: var(--spark-transition);
            font-family: 'Nunito', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--spark-primary);
            box-shadow: 0 0 0 3px rgba(52, 144, 220, 0.2);
        }

        .login-btn {
            background-color: var(--spark-primary);
            color: white;
            border: none;
            border-radius: var(--spark-radius);
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--spark-transition);
            font-family: 'Nunito', sans-serif;
        }

        .login-btn:hover {
            background-color: var(--spark-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            background-color: white;
            border: 1px solid var(--spark-border);
            border-radius: var(--spark-radius);
            transition: var(--spark-transition);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--spark-gray);
        }

        .tab.active {
            background-color: var(--spark-primary);
            color: white;
            font-weight: bold;
            border-color: var(--spark-primary);
        }

        .tab:hover:not(.active) {
            background-color: var(--spark-gray-light);
            color: var(--spark-dark);
        }

        .tab-content {
            display: none;
            background-color: #fff;
            padding: 1.5rem;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            border: 1px solid var(--spark-border);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .content-wrapper {
            display: flex;
            gap: 1.5rem;
            flex: 1;
        }

        .sidebar {
            width: var(--spark-sidebar-width);
            background-color: #fff;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            padding: 1rem;
            transition: var(--spark-transition);
            border: 1px solid var(--spark-border);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Component Styles */
        .user-info, .container-info, .google-config, .form-container, .export-controls, .summary {
            background-color: #fff;
            padding: 1.25rem;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--spark-border);
        }

        .container-info {
            background-color: #ebf4ff;
            border-left: 4px solid var(--spark-primary);
        }

        .google-config {
            border-left: 4px solid #4285F4;
        }

        .google-config h3 {
            color: #4285F4;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }

        .summary {
            background: white;
            text-align: center;
            font-weight: bold;
            padding: 1.5rem;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .summary-item {
            padding: 1.25rem;
            background: white;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            min-width: 200px;
            flex: 1;
            border: 1px solid var(--spark-border);
        }

        .summary-item i {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            color: var(--spark-primary);
        }

        .summary-value {
            font-size: 1.75rem;
            font-weight: bold;
            color: var(--spark-dark);
            margin: 0.25rem 0;
        }

        .summary-label {
            color: var(--spark-gray);
            font-size: 0.875rem;
        }

        /* Form Styles */
        .form-group {
            display: flex;
            gap: 1.25rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .form-group > div {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px;
        }

        label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--spark-dark);
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.875rem;
        }

        input, select {
            padding: 0.75rem;
            border: 1px solid var(--spark-border);
            border-radius: var(--spark-radius);
            font-size: 1rem;
            transition: var(--spark-transition);
            font-family: 'Nunito', sans-serif;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--spark-primary);
            box-shadow: 0 0 0 3px rgba(52, 144, 220, 0.2);
        }

        input:read-only {
            background-color: #f0f0f0;
            cursor: not-allowed;
        }

        input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .input-with-button {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Button Styles */
        button {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: var(--spark-radius);
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--spark-transition);
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
        }

        .btn-primary {
            background-color: var(--spark-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--spark-primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-info {
            background-color: var(--spark-info);
            color: white;
        }

        .btn-info:hover {
            background-color: #5a9fe4;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-warning {
            background-color: var(--spark-warning);
            color: var(--spark-dark);
        }

        .btn-warning:hover {
            background-color: #f2d024;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-excel {
            background-color: var(--spark-success);
            color: white;
        }

        .btn-excel:hover {
            background-color: var(--spark-success-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-logout {
            background-color: var(--spark-danger);
            color: white;
        }

        .btn-logout:hover {
            background-color: var(--spark-danger-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .button-group {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background-color: #fff;
            border-radius: var(--spark-radius);
            overflow: hidden;
            box-shadow: var(--spark-shadow);
            border: 1px solid var(--spark-border);
        }

        th, td {
            padding: 0.875rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--spark-border);
            font-size: 0.875rem;
        }

        th {
            background-color: #f7fafc;
            font-weight: 600;
            color: var(--spark-dark);
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f7fafc;
        }

        .actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn-edit {
            color: var(--spark-primary);
            cursor: pointer;
            transition: var(--spark-transition);
        }

        .btn-edit:hover {
            transform: scale(1.2);
        }

        .btn-delete {
            color: var(--spark-danger);
            cursor: pointer;
            transition: var(--spark-transition);
        }

        .btn-delete:hover {
            transform: scale(1.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--spark-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--spark-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            position: relative;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--spark-dark);
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .close-modal:hover {
            background-color: #e9ecef;
        }

        .modal-form-group {
            margin-bottom: 1rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .empty-state {
            text-align: center;
            padding: 2.5rem;
            color: var(--spark-gray);
        }

        .notification {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: var(--spark-success);
            color: white;
            padding: 0.875rem 1.25rem;
            border-radius: var(--spark-radius);
            box-shadow: var(--spark-shadow);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-weight: 600;
        }

        .notification.error {
            background-color: var(--spark-danger);
        }

        /* Google Connection Status */
        .google-connection-status {
            display: inline-flex;
            align-items: center;
            margin-left: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .google-connected {
            background-color: var(--spark-success);
            color: white;
        }

        .google-disconnected {
            background-color: var(--spark-gray);
            color: white;
        }

        .google-error {
            background-color: var(--spark-danger);
            color: white;
        }

        .sync-button {
            background-color: var(--spark-primary);
            color: white;
            border: none;
            border-radius: var(--spark-radius);
            padding: 0.625rem 0.875rem;
            cursor: pointer;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            font-weight: 600;
        }

        .sync-button:hover {
            background-color: var(--spark-primary-dark);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                margin-bottom: 1.5rem;
            }
            
            .summary {
                flex-direction: column;
            }
            
            .summary-item {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .form-group {
                flex-direction: column;
                gap: 1rem;
            }
            
            .form-group > div {
                width: 100%;
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.75rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .modal-content {
                padding: 1.25rem;
                width: 95%;
            }
        }

        /* Checkbox Styles */
        .checkbox-cell {
            width: 40px;
            text-align: center;
        }

        .select-all-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .data-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .delete-selected-container {
            margin-bottom: 1rem;
            display: flex;
            justify-content: flex-end;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-finding {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-ok {
            background-color: #d4edda;
            color: #155724;
        }

        .status-double-ean {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-update-master {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .finding-row {
            background-color: #fff3cd !important;
            border-left: 4px solid #ffc107;
        }

        .finding-row:hover {
            background-color: #ffeaa7 !important;
        }

        /* Sync Indicator */
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .sync-indicator.active {
            background-color: #3498db;
            color: white;
        }
        
        .sync-indicator.idle {
            background-color: #7f8c8d;
            color: white;
        }
        
        .sync-indicator.error {
            background-color: #e74c3c;
            color: white;
        }
        
        .last-sync-time {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--spark-dark);
        }

        @media (max-width: 992px) {
            .mobile-menu-btn {
                display: block;
            }
            
            .sidebar.collapsed {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h2><i class="fas fa-user"></i> SAMSONITE SCAN</h2>
            <p>Silakan masukkan username Anda untuk melanjutkan</p>
            <form id="loginForm" class="login-form">
                <input type="text" id="usernameInput" class="form-input" placeholder="Masukkan username" required autofocus>
                <button type="submit" class="login-btn"><i class="fas fa-check"></i> Lanjutkan</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1><i class="fas fa-barcode"></i> SCAN MODULE</h1>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <div class="content-wrapper">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="tabs">
                    <div class="tab active" data-tab="input"><i class="fas fa-keyboard"></i> Input Data</div>
                    <div class="tab" data-tab="scanResult"><i class="fas fa-table"></i> Hasil Scan</div>
                    <div class="tab" data-tab="dashboard"><i class="fas fa-chart-pie"></i> Dashboard</div>
                    <div class="tab" data-tab="master"><i class="fas fa-database"></i> Master Data</div>
                    <div class="tab" data-tab="google"><i class="fab fa-google"></i> Google Sheets</div>
                </div>
                
                <div class="user-info">
                    <p>
                        <i class="fas fa-user"></i> User: <span id="currentUser">Guest</span>
                        <span id="googleStatusIndicator" class="google-connection-status google-disconnected">
                            <i class="fab fa-google"></i> <span id="googleStatusText">Tidak Terkoneksi</span>
                        </span>
                    </p>
                    <div class="button-group">
                        <button type="button" class="btn-logout" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Tab 1: Input Data -->
                <div class="tab-content active" id="inputTab">
                    <div class="container-info">
                        <p><i class="fas fa-info-circle"></i> No. Pallet: <span id="currentPallet">Belum dipilih</span></p>
                        <p><i class="fas fa-truck"></i> No. Container: <span id="currentContainer">Belum dipilih</span></p>
                        <p><i class="fas fa-users"></i> Customer: <span id="currentCustomer">Belum dipilih</span></p>
                    </div>
                    
                    <div class="form-container">
                        <form id="dataForm">
                            <div class="form-group">
                                <div>
                                    <label for="customer"><i class="fas fa-users"></i> Customer</label>
                                    <select id="customer" required>
                                        <option value="">Pilih Customer</option>
                                        <option value="Samsonite">Samsonite</option>
                                        <option value="Tumi">Tumi</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="container"><i class="fas fa-truck"></i> No. Container</label>
                                    <div class="input-with-button">
                                        <input type="text" id="container" required placeholder="Masukkan No. Container">
                                        <button type="button" class="btn-info" id="saveContainerBtn"><i class="fas fa-save"></i> Simpan Container</button>
                                    </div>
                                </div>
                                <div>
                                    <label for="pallet"><i class="fas fa-pallet"></i> Pallet ID</label>
                                    <div class="input-with-button">
                                        <input type="text" id="pallet" required placeholder="Masukkan Pallet ID">
                                        <button type="button" class="btn-info" id="savePalletBtn"><i class="fas fa-save"></i> Simpan Pallet</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div>
                                    <label for="ean"><i class="fas fa-barcode"></i> EAN</label>
                                    <input type="text" id="ean" required placeholder="Scan atau masukkan EAN" disabled>
                                    <small id="eanHelpText" style="color: #e74c3c; display: none;">
                                        <i class="fas fa-exclamation-circle"></i> Set Container, Pallet, dan Customer terlebih dahulu
                                    </small>
                                </div>
                                <div>
                                    <label for="qty"><i class="fas fa-cubes"></i> Qty</label>
                                    <input type="number" id="qty" value="1" min="1" disabled>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div>
                                    <label for="sku"><i class="fas fa-tag"></i> SKU</label>
                                    <input type="text" id="sku" readonly placeholder="Akan terisi otomatis">
                                </div>
                                <div>
                                    <label for="description"><i class="fas fa-align-left"></i> Description</label>
                                    <input type="text" id="description" readonly placeholder="Akan terisi otomatis">
                                </div>
                                <div>
                                    <label for="status"><i class="fas fa-exclamation-triangle"></i> Status</label>
                                    <input type="text" id="status" readonly placeholder="Akan terisi otomatis">
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <button type="button" class="btn-primary" id="saveDataBtn"><i class="fas fa-save"></i> Simpan Data</button>
                                <button type="button" class="sync-button" id="syncButton">
                                    <i class="fas fa-sync-alt"></i> Sync Data
                                    <span id="syncStatusIndicator" class="sync-indicator idle">
                                        <i class="fas fa-circle"></i>
                                        <span>Idle</span>
                                    </span>
                                </button>
                            </div>
                            <div class="last-sync-time" id="lastSyncTime">
                                Terakhir sync: -
                            </div>
                        </form>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <i class="fas fa-barcode"></i>
                            <div class="summary-value" id="totalEan">0</div>
                            <div class="summary-label">Total EAN</div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-truck"></i>
                            <div class="summary-value" id="totalContainer">0</div>
                            <div class="summary-label">Total Qty Container</div>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Scan Results -->
                <div class="tab-content" id="scanResultTab">
                    <div class="google-config">
                        <h3><i class="fas fa-table"></i> Hasil Input Scan</h3>
                        <p>Data hasil scanning yang telah disimpan</p>
                    </div>

                    <div class="filter-controls">
                        <div class="form-group">
                            <div>
                                <label for="filterPallet"><i class="fas fa-filter"></i> Filter by Pallet</label>
                                <input type="text" id="filterPallet" placeholder="Masukkan Pallet ID">
                            </div>
                            <div>
                                <button type="button" class="btn-info" id="applyFilterBtn"><i class="fas fa-check"></i> Terapkan Filter</button>
                                <button type="button" class="btn-warning" id="resetFilterBtn"><i class="fas fa-times"></i> Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="delete-selected-container">
                        <button type="button" class="btn-logout" id="deleteSelectedBtn"><i class="fas fa-trash"></i> Hapus Data Terpilih</button>
                    </div>
                    
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th class="checkbox-cell"><input type="checkbox" id="selectAllCheckbox"></th>
                                <th>Customer</th>
                                <th>Container</th>
                                <th>Pallet</th>
                                <th>EAN</th>
                                <th>SKU</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Status</th>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div id="emptyState" class="empty-state hidden">
                        <i class="fas fa-inbox"></i>
                        <h3>Belum ada data</h3>
                        <p>Mulai scan data di tab Input Data</p>
                    </div>
                </div>

                <!-- Tab 3: Dashboard -->
                <div class="tab-content" id="dashboardTab">
                    <div class="google-config">
                        <h3><i class="fas fa-chart-pie"></i> Dashboard Summary</h3>
                        <p>Ringkasan dan statistik data scanning</p>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <i class="fas fa-truck"></i>
                            <div class="summary-value" id="totalContainerDashboard">0</div>
                            <div class="summary-label">Total Container</div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-cubes"></i>
                            <div class="summary-value" id="totalQtyDashboard">0</div>
                            <div class="summary-label">Total Qty</div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="summary-value" id="totalFinding">0</div>
                            <div class="summary-label">Total Finding</div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-exclamation-circle"></i>
                            <div class="summary-value" id="totalDoubleEAN">0</div>
                            <div class="summary-label">Double EAN</div>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Master Data -->
                <div class="tab-content" id="masterTab">
                    <div class="google-config">
                        <h3><i class="fas fa-database"></i> Master Data</h3>
                        <p>Kelola data master EAN, SKU, dan Description</p>
                    </div>
                    
                    <div class="form-container">
                        <form id="masterDataForm">
                            <div class="form-group">
                                <div>
                                    <label for="masterEan"><i class="fas fa-barcode"></i> EAN</label>
                                    <input type="text" id="masterEan" required placeholder="Masukkan EAN">
                                </div>
                                <div>
                                    <label for="masterSku"><i class="fas fa-tag"></i> SKU</label>
                                    <input type="text" id="masterSku" required placeholder="Masukkan SKU">
                                </div>
                                <div>
                                    <label for="masterDescription"><i class="fas fa-align-left"></i> Description</label>
                                    <input type="text" id="masterDescription" required placeholder="Masukkan deskripsi">
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <button type="submit" class="btn-primary"><i class="fas fa-plus"></i> Tambah Data</button>
                                <button type="button" class="btn-excel" id="exportMasterBtn"><i class="fas fa-file-excel"></i> Export Master</button>
                            </div>
                        </form>
                    </div>

                    <div class="delete-selected-container">
                        <button type="button" class="btn-logout" id="deleteSelectedMasterBtn"><i class="fas fa-trash"></i> Hapus Data Terpilih</button>
                    </div>
                    
                    <table id="masterDataTable">
                        <thead>
                            <tr>
                                <th class="checkbox-cell"><input type="checkbox" id="selectAllMasterCheckbox"></th>
                                <th>EAN</th>
                                <th>SKU</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="masterTableBody">
                            <!-- Data master akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                    
                    <div id="masterEmptyState" class="empty-state hidden">
                        <i class="fas fa-inbox"></i>
                        <h3>Belum ada data master</h3>
                        <p>Tambahkan data master menggunakan form di atas</p>
                    </div>
                </div>

                <!-- Tab 5: Google Sheets Config -->
                <div class="tab-content" id="googleTab">
                    <div class="google-config">
                        <h3><i class="fab fa-google"></i> Konfigurasi Google Sheets</h3>
                        <p>Setup koneksi dengan Google Sheets untuk sync data</p>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <div>
                                <label for="googleScriptUrl"><i class="fas fa-link"></i> Google Apps Script URL</label>
                                <input type="text" id="googleScriptUrl" placeholder="Masukkan URL deployment GAS">
                                <small>URL dari Google Apps Script yang telah di-deploy</small>
                            </div>
                            <div>
                                <label for="sheetId"><i class="fas fa-table"></i> Google Sheet ID</label>
                                <input type="text" id="sheetId" placeholder="Masukkan ID Google Sheet">
                                <small>ID dari URL Google Sheet: docs.google.com/spreadsheets/d/[SHEET_ID]/edit</small>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn-info" id="saveGoogleConfigBtn"><i class="fas fa-save"></i> Simpan Konfigurasi</button>
                            <button type="button" class="btn-primary" id="testGoogleConnectionBtn"><i class="fas fa-plug"></i> Test Koneksi</button>
                        </div>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <i class="fab fa-google"></i>
                            <div class="summary-value" id="googleStatus">Not Connected</div>
                            <div class="summary-label">Status Koneksi</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // ========== KONSTANTA DAN VARIABEL GLOBAL ==========
        const DB_NAME = 'ScanModuleDB';
        const DB_VERSION = 3;
        const SCANNED_DATA_STORE = 'scannedData';
        const MASTER_DATA_STORE = 'masterData';
        const DELETED_DATA_STORE = 'deletedData';

        // Variabel global
        let db;
        let scannedData = [];
        let masterData = [];
        let deletedDataIds = [];
        let currentUser = 'Guest';
        let currentPallet = '';
        let currentContainer = '';
        let currentCustomer = '';
        let isSyncing = false;

        // Konfigurasi Google Sheets
        let googleConfig = {
            scriptUrl: '',
            sheetId: '',
            autoSync: true,
            autoSyncInterval: 5
        };

        // ========== INISIALISASI DATABASE ==========
        function initIndexDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    if (!db.objectStoreNames.contains(SCANNED_DATA_STORE)) {
                        const store = db.createObjectStore(SCANNED_DATA_STORE, { keyPath: 'id' });
                        store.createIndex('timestamp', 'timestamp');
                        store.createIndex('user', 'user');
                    }
                    
                    if (!db.objectStoreNames.contains(MASTER_DATA_STORE)) {
                        const store = db.createObjectStore(MASTER_DATA_STORE, { keyPath: 'ean' });
                        store.createIndex('sku', 'sku');
                    }
                    
                    if (!db.objectStoreNames.contains(DELETED_DATA_STORE)) {
                        db.createObjectStore(DELETED_DATA_STORE, { keyPath: 'id' });
                    }
                };
            });
        }

        // ========== OPERASI DATABASE ==========
        async function saveScannedDataToIndexDB(data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([SCANNED_DATA_STORE], 'readwrite');
                const store = transaction.objectStore(SCANNED_DATA_STORE);
                const request = store.put(data);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllScannedDataFromIndexDB() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([SCANNED_DATA_STORE], 'readonly');
                const store = transaction.objectStore(SCANNED_DATA_STORE);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(request.error);
            });
        }

        async function saveMasterDataToIndexDB(data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MASTER_DATA_STORE], 'readwrite');
                const store = transaction.objectStore(MASTER_DATA_STORE);
                const request = store.put(data);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllMasterDataFromIndexDB() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([MASTER_DATA_STORE], 'readonly');
                const store = transaction.objectStore(MASTER_DATA_STORE);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(request.error);
            });
        }

        // ========== FUNGSI UTILITAS ==========
        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function findMasterData(ean) {
            return masterData.find(item => item.ean === ean);
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            if (type === 'error') notification.classList.add('error');
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleString('id-ID');
        }

        // ========== FUNGSI UI ==========
        function updateFormFieldsState() {
            const eanInput = document.getElementById('ean');
            const qtyInput = document.getElementById('qty');
            const eanHelpText = document.getElementById('eanHelpText');
            
            const enabled = currentContainer && currentPallet && currentCustomer;
            
            eanInput.disabled = !enabled;
            qtyInput.disabled = !enabled;
            eanHelpText.style.display = enabled ? 'none' : 'block';
        }

        function checkEanAndFillFields(ean) {
            const masterItem = findMasterData(ean);
            const skuInput = document.getElementById('sku');
            const descriptionInput = document.getElementById('description');
            const statusInput = document.getElementById('status');
            
            if (masterItem) {
                skuInput.value = masterItem.sku;
                descriptionInput.value = masterItem.description;
                statusInput.value = 'OK';
            } else {
                skuInput.value = '';
                descriptionInput.value = '';
                statusInput.value = 'Finding';
            }
        }

        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            const emptyState = document.getElementById('emptyState');
            
            tableBody.innerHTML = '';
            
            if (scannedData.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            scannedData.forEach((item, index) => {
                const row = document.createElement('tr');
                if (item.status !== 'OK') row.classList.add('finding-row');
                
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="data-checkbox" data-index="${index}">
                    </td>
                    <td>${item.customer}</td>
                    <td>${item.container}</td>
                    <td>${item.pallet}</td>
                    <td>${item.ean}</td>
                    <td>${item.sku}</td>
                    <td>${item.description}</td>
                    <td>${item.qty}</td>
                    <td>
                        <span class="status-badge status-${item.status.toLowerCase().replace(' ', '-')}">
                            ${item.status}
                        </span>
                    </td>
                    <td>${formatTimestamp(item.timestamp)}</td>
                    <td>${item.user}</td>
                    <td class="actions">
                        <i class="fas fa-trash btn-delete" data-index="${index}" title="Hapus"></i>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Setup event listeners untuk delete buttons
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteData(index);
                });
            });
        }

        function renderMasterTable() {
            const masterTableBody = document.getElementById('masterTableBody');
            const masterEmptyState = document.getElementById('masterEmptyState');
            
            masterTableBody.innerHTML = '';
            
            if (masterData.length === 0) {
                masterEmptyState.classList.remove('hidden');
                return;
            }
            
            masterEmptyState.classList.add('hidden');
            
            masterData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="master-data-checkbox" data-index="${index}">
                    </td>
                    <td>${item.ean}</td>
                    <td>${item.sku}</td>
                    <td>${item.description}</td>
                    <td class="actions">
                        <i class="fas fa-trash btn-delete-master" data-index="${index}" title="Hapus"></i>
                    </td>
                `;
                masterTableBody.appendChild(row);
            });
            
            // Setup event listeners untuk delete buttons
            document.querySelectorAll('.btn-delete-master').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteMasterData(index);
                });
            });
        }

        function updateDashboardSummary() {
            // Hitung total container unik
            const uniqueContainers = new Set(scannedData.map(item => item.container)).size;
            document.getElementById('totalContainerDashboard').textContent = uniqueContainers;
            
            // Hitung total quantity
            const totalQty = scannedData.reduce((sum, item) => sum + parseInt(item.qty), 0);
            document.getElementById('totalQtyDashboard').textContent = totalQty;
            
            // Hitung findings
            const totalFinding = scannedData.filter(item => item.status === 'Finding').length;
            document.getElementById('totalFinding').textContent = totalFinding;
            
            // Hitung double EAN
            const totalDoubleEAN = scannedData.filter(item => item.status === 'Double EAN').length;
            document.getElementById('totalDoubleEAN').textContent = totalDoubleEAN;
        }

        function updateLocalSummary() {
            // Hitung total EAN untuk container dan pallet saat ini
            if (currentContainer && currentPallet) {
                const total = scannedData
                    .filter(item => item.container === currentContainer && item.pallet === currentPallet)
                    .reduce((sum, item) => sum + parseInt(item.qty), 0);
                document.getElementById('totalEan').textContent = total;
            }
            
            // Hitung total quantity untuk container saat ini
            if (currentContainer) {
                const total = scannedData
                    .filter(item => item.container === currentContainer)
                    .reduce((sum, item) => sum + parseInt(item.qty), 0);
                document.getElementById('totalContainer').textContent = total;
            }
        }

        // ========== FUNGSI DATA ==========
        async function saveScannedData() {
            const eanInput = document.getElementById('ean');
            const qtyInput = document.getElementById('qty');
            
            if (!currentContainer || !currentPallet || !currentCustomer) {
                showNotification('Harap set Container, Pallet, dan Customer terlebih dahulu!', 'error');
                return;
            }
            
            if (!eanInput.value.trim()) {
                showNotification('Harap masukkan kode EAN!', 'error');
                return;
            }
            
            const newData = {
                id: generateId(),
                customer: currentCustomer,
                container: currentContainer,
                pallet: currentPallet,
                ean: eanInput.value.trim(),
                qty: parseInt(qtyInput.value) || 1,
                sku: document.getElementById('sku').value,
                description: document.getElementById('description').value,
                status: document.getElementById('status').value,
                user: currentUser,
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0],
                version: 1
            };
            
            try {
                scannedData.push(newData);
                await saveScannedDataToIndexDB(newData);
                
                // Reset form
                eanInput.value = '';
                document.getElementById('sku').value = '';
                document.getElementById('description').value = '';
                document.getElementById('status').value = '';
                
                // Update UI
                renderTable();
                updateLocalSummary();
                updateDashboardSummary();
                
                showNotification('Data berhasil disimpan!');
                eanInput.focus();
                
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Error menyimpan data: ' + error.message, 'error');
            }
        }

        async function deleteData(index) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
            
            try {
                const item = scannedData[index];
                scannedData.splice(index, 1);
                
                const transaction = db.transaction([SCANNED_DATA_STORE], 'readwrite');
                const store = transaction.objectStore(SCANNED_DATA_STORE);
                await store.delete(item.id);
                
                // Simpan deleted ID
                const deletedTransaction = db.transaction([DELETED_DATA_STORE], 'readwrite');
                const deletedStore = deletedTransaction.objectStore(DELETED_DATA_STORE);
                await deletedStore.put({ id: item.id, timestamp: new Date().toISOString() });
                
                renderTable();
                updateLocalSummary();
                updateDashboardSummary();
                showNotification('Data berhasil dihapus');
                
            } catch (error) {
                console.error('Error deleting data:', error);
                showNotification('Error menghapus data: ' + error.message, 'error');
            }
        }

        async function addMasterData() {
            const eanInput = document.getElementById('masterEan');
            const skuInput = document.getElementById('masterSku');
            const descriptionInput = document.getElementById('masterDescription');
            
            if (!eanInput.value.trim() || !skuInput.value.trim()) {
                showNotification('EAN dan SKU wajib diisi!', 'error');
                return;
            }
            
            const newMasterData = {
                ean: eanInput.value.trim(),
                sku: skuInput.value.trim(),
                description: descriptionInput.value.trim()
            };
            
            try {
                // Cek apakah EAN sudah ada
                const existingIndex = masterData.findIndex(item => item.ean === newMasterData.ean);
                if (existingIndex >= 0) {
                    masterData[existingIndex] = newMasterData;
                } else {
                    masterData.push(newMasterData);
                }
                
                await saveMasterDataToIndexDB(newMasterData);
                
                // Reset form
                eanInput.value = '';
                skuInput.value = '';
                descriptionInput.value = '';
                
                renderMasterTable();
                showNotification('Data master berhasil disimpan!');
                
            } catch (error) {
                console.error('Error saving master data:', error);
                showNotification('Error menyimpan data master: ' + error.message, 'error');
            }
        }

        async function deleteMasterData(index) {
            if (!confirm('Apakah Anda yakin ingin menghapus data master ini?')) return;
            
            try {
                const item = masterData[index];
                masterData.splice(index, 1);
                
                const transaction = db.transaction([MASTER_DATA_STORE], 'readwrite');
                const store = transaction.objectStore(MASTER_DATA_STORE);
                await store.delete(item.ean);
                
                renderMasterTable();
                showNotification('Data master berhasil dihapus');
                
            } catch (error) {
                console.error('Error deleting master data:', error);
                showNotification('Error menghapus data master: ' + error.message, 'error');
            }
        }

        // ========== FUNGSI GOOGLE SHEETS ==========
        async function testGoogleConnection() {
            if (!googleConfig.scriptUrl || !googleConfig.sheetId) {
                showNotification('Harap isi URL GAS dan Sheet ID terlebih dahulu!', 'error');
                return;
            }
            
            try {
                const response = await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'testConnection',
                        sheetId: googleConfig.sheetId,
                        timestamp: new Date().toISOString()
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Koneksi Google Sheets berhasil!', 'success');
                    document.getElementById('googleStatus').textContent = 'Connected';
                    document.getElementById('googleStatus').style.color = '#27ae60';
                    updateGoogleStatus(true, 'Terkoneksi');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Connection test failed:', error);
                showNotification('Koneksi gagal: ' + error.message, 'error');
                document.getElementById('googleStatus').textContent = 'Error';
                document.getElementById('googleStatus').style.color = '#e74c3c';
                updateGoogleStatus(false, 'Error koneksi');
            }
        }

        async function syncToGoogleSheets() {
            if (!googleConfig.scriptUrl || !googleConfig.sheetId) {
                showNotification('Harap konfigurasi Google Sheets terlebih dahulu!', 'error');
                return;
            }
            
            if (isSyncing) {
                showNotification('Sync sedang berjalan...', 'error');
                return;
            }
            
            isSyncing = true;
            updateSyncStatus('active', 'Syncing...');
            
            try {
                const response = await fetch(googleConfig.scriptUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'saveData',
                        sheetId: googleConfig.sheetId,
                        scannedData: scannedData,
                        masterData: masterData,
                        deletedDataIds: deletedDataIds,
                        timestamp: new Date().toISOString(),
                        user: currentUser
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Sync berhasil! Data tersimpan ke Google Sheets', 'success');
                    updateSyncStatus('idle', 'Sync berhasil');
                    updateLastSyncTime();
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('Sync failed:', error);
                showNotification('Sync gagal: ' + error.message, 'error');
                updateSyncStatus('error', 'Sync gagal');
            } finally {
                isSyncing = false;
            }
        }

        function updateGoogleStatus(connected, message) {
            const indicator = document.getElementById('googleStatusIndicator');
            const text = document.getElementById('googleStatusText');
            
            indicator.className = 'google-connection-status';
            indicator.classList.add(connected ? 'google-connected' : 'google-disconnected');
            text.textContent = message;
        }

        function updateSyncStatus(status, message) {
            const indicator = document.getElementById('syncStatusIndicator');
            const icon = indicator.querySelector('i');
            const text = indicator.querySelector('span');
            
            indicator.className = 'sync-indicator';
            indicator.classList.add(status);
            
            if (status === 'active') {
                icon.className = 'fas fa-sync-alt fa-spin';
            } else if (status === 'idle') {
                icon.className = 'fas fa-check-circle';
            } else {
                icon.className = 'fas fa-exclamation-circle';
            }
            
            text.textContent = message;
        }

        function updateLastSyncTime() {
            document.getElementById('lastSyncTime').textContent = 
                'Terakhir sync: ' + new Date().toLocaleString('id-ID');
        }

        function loadGoogleConfig() {
            const saved = localStorage.getItem('googleConfig');
            if (saved) {
                googleConfig = JSON.parse(saved);
                document.getElementById('googleScriptUrl').value = googleConfig.scriptUrl || '';
                document.getElementById('sheetId').value = googleConfig.sheetId || '';
            }
        }

        function saveGoogleConfig() {
            googleConfig.scriptUrl = document.getElementById('googleScriptUrl').value.trim();
            googleConfig.sheetId = document.getElementById('sheetId').value.trim();
            
            localStorage.setItem('googleConfig', JSON.stringify(googleConfig));
            showNotification('Konfigurasi Google Sheets berhasil disimpan!');
        }

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('usernameInput').value.trim();
                if (username) {
                    currentUser = username;
                    document.getElementById('currentUser').textContent = currentUser;
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    showNotification(`Selamat datang, ${currentUser}!`);
                    initApp();
                }
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('usernameInput').value = '';
                currentUser = 'Guest';
            });

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(this.getAttribute('data-tab') + 'Tab').classList.add('active');
                });
            });

            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('collapsed');
            });

            // Container & Pallet
            document.getElementById('saveContainerBtn').addEventListener('click', function() {
                currentContainer = document.getElementById('container').value.trim();
                if (currentContainer) {
                    document.getElementById('currentContainer').textContent = currentContainer;
                    updateFormFieldsState();
                    showNotification('Container berhasil disimpan');
                }
            });

            document.getElementById('savePalletBtn').addEventListener('click', function() {
                currentPallet = document.getElementById('pallet').value.trim();
                if (currentPallet) {
                    document.getElementById('currentPallet').textContent = currentPallet;
                    updateFormFieldsState();
                    showNotification('Pallet berhasil disimpan');
                }
            });

            // Customer
            document.getElementById('customer').addEventListener('change', function() {
                currentCustomer = this.value;
                document.getElementById('currentCustomer').textContent = currentCustomer;
                updateFormFieldsState();
            });

            // EAN input dengan auto-check
            document.getElementById('ean').addEventListener('input', function() {
                checkEanAndFillFields(this.value);
            });

            // Save data
            document.getElementById('saveDataBtn').addEventListener('click', saveScannedData);

            // Master data form
            document.getElementById('masterDataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addMasterData();
            });

            // Google Sheets
            document.getElementById('saveGoogleConfigBtn').addEventListener('click', saveGoogleConfig);
            document.getElementById('testGoogleConnectionBtn').addEventListener('click', testGoogleConnection);
            document.getElementById('syncButton').addEventListener('click', syncToGoogleSheets);

            // Export master data
            document.getElementById('exportMasterBtn').addEventListener('click', function() {
                if (masterData.length === 0) {
                    showNotification('Tidak ada data master untuk diekspor!', 'error');
                    return;
                }
                
                const ws = XLSX.utils.json_to_sheet(masterData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Master Data');
                XLSX.writeFile(wb, `Master_Data_${new Date().toISOString().slice(0, 10)}.xlsx`);
                showNotification('Data master berhasil diekspor!');
            });
        });

        // ========== INISIALISASI APLIKASI ==========
        async function initApp() {
            try {
                await initIndexDB();
                await loadData();
                loadGoogleConfig();
                updateFormFieldsState();
                showNotification('Aplikasi siap digunakan!');
            } catch (error) {
                console.error('Error initializing app:', error);
                showNotification('Error inisialisasi aplikasi: ' + error.message, 'error');
            }
        }

        async function loadData() {
            scannedData = await getAllScannedDataFromIndexDB();
            masterData = await getAllMasterDataFromIndexDB();
            
            renderTable();
            renderMasterTable();
            updateLocalSummary();
            updateDashboardSummary();
        }
    </script>
</body>
</html>
